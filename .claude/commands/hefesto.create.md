---
description: "Create new Agent Skill from natural language description with Human Gate approval"
command: "/hefesto.create"
category: "skill-management"
user_story: "US1"
priority: "P1"
version: "1.0.0"
---

# /hefesto.create - Create Skill Command

**Command**: `/hefesto.create`  
**Purpose**: Generate new Agent Skill from natural language description  
**User Story**: US1 - Core Skill Creation & Extraction (P1)

---

## Overview

The `/hefesto.create` command generates Agent Skills from natural language descriptions following agentskills.io specification. Features:

1. **Wizard Mode**: Interactive prompts when arguments missing
2. **Human Gate**: Mandatory approval before persistence (T0-HEFESTO-02)
3. **Multi-CLI**: Auto-detect and generate for all installed CLIs (T0-HEFESTO-04)
4. **Validation**: Pre-persist validation against T0 rules (T0-HEFESTO-06)
5. **Collision Handling**: Safe handling of existing skills (T0-HEFESTO-08)

**Target Performance**: < 7s (excluding Human Gate wait)

---

## Command Signature

```text
/hefesto.create [description] [--target <cli>] [--template <name>]

Arguments:
  description    Natural language description of skill to create (optional)
                 If missing: Enter Wizard Mode
                 Max length: 2000 characters

Options:
  --target <cli>     Target specific CLI (default: all detected)
                     Values: claude, gemini, codex, copilot, opencode, cursor, qwen
  --template <name>  Use specific template variant (default: base)
```

---

## Execution Workflow

### Phase 0: Pre-Execution Validation

```markdown
1. Validate CONSTITUTION
   (see: helpers/constitution-validator.md)
   IF invalid ‚Üí ABORT with ERR-CREATE-000

2. Check Hefesto initialization
   IF NOT file_exists("MEMORY.md"):
     DISPLAY: "‚ùå Hefesto not initialized. Run /hefesto.init first."
     ABORT (exit code 1)

3. Load context from /.context/
   - Read T0 rules from CONSTITUTION.md
   - Load skill templates from commands/templates/
   - Load CLI detection from MEMORY.md
```

**Performance Target**: < 500ms  
**References**: T0-HEFESTO-02, FR-002

---

### Phase 1: Argument Parsing & Wizard Mode

```markdown
1. Parse command arguments
   args = parse_input(user_input)
   description = args.positional[0] OR null
   target_cli = args.flags.get("target") OR null
   template_name = args.flags.get("template") OR "base"

2. Check if Wizard Mode needed
   IF description IS null:
     TRIGGER wizard_mode()
   
3. Validate description
   IF length(description) > 2000:
     ERROR E-CREATE-001: "Description exceeds 2000 characters"
     SUGGEST: "Shorten description and try again"
     ABORT
```

**Performance Target**: < 100ms  
**References**: FR-003, FR-010

---

### Wizard Mode Flow

```markdown
WIZARD MODE ACTIVATED
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Step 1: Skill Description
  PROMPT: "What should this skill do? (1-2 sentences)"
  EXAMPLE: "Validate email addresses using regex patterns"
  
  INPUT: description
  VALIDATE:
    - NOT empty (E-CREATE-007)
    - Length <= 2000 chars (E-CREATE-001)
    - No injection patterns (T0-HEFESTO-11)
  
  IF invalid: RETRY (max 3 attempts)

Step 2: Skill Name (Auto-Generated)
  DISPLAY: "Suggested name: <auto-generated-name>"
  PROMPT: "Press Enter to accept, or type custom name:"
  
  INPUT: custom_name OR accept_default
  VALIDATE:
    - Lowercase only (T0-HEFESTO-07)
    - Hyphens only for separators
    - Max 64 characters
    - No consecutive hyphens
  
  AUTO-SANITIZE: Convert to valid format if possible

Step 3: Target CLIs
  DISPLAY: "Detected CLIs: <cli-list>"
  PROMPT: "Target CLIs (comma-separated or 'all') [all]:"
  
  INPUT: target_selection OR default_all
  VALIDATE: Each CLI exists in detected list

Step 4: Confirmation
  DISPLAY: "Preview:"
  DISPLAY: "  Name: <skill-name>"
  DISPLAY: "  Description: <description>"
  DISPLAY: "  Target CLIs: <targets>"
  PROMPT: "[continue] [edit] [cancel]"
  
  CASE input:
    "continue" ‚Üí PROCEED to Phase 2
    "edit" ‚Üí GOTO Step 1
    "cancel" ‚Üí ABORT gracefully
```

**Timeout**: 300 seconds (5 minutes) of inactivity triggers cleanup  
**References**: FR-003, spec.md L88-94

---

### Phase 2: Skill Generation

```markdown
1. Load appropriate template
   template = load_template(template_name)
   IF template NOT found:
     ERROR E-CREATE-008: "Template not found: {template_name}"
     ABORT

2. Generate skill name (if not custom)
   skill_name = custom_name OR auto_generate_name(description)
   skill_name = sanitize_name(skill_name)  # T0-HEFESTO-07

3. Detect collision
   FOR EACH target_cli IN targets:
     skill_path = ".{cli}/skills/{skill_name}/SKILL.md"
     IF file_exists(skill_path):
       TRIGGER collision_gate()  # FR-008

4. Generate skill content
   skill_content = template.render({
     name: skill_name,
     description: description,
     created: current_timestamp(),
     version: "1.0.0",
     category: infer_category(description),
     cli: target_cli
   })

5. Generate metadata
   metadata = generate_metadata({
     name: skill_name,
     description: description,
     created: current_timestamp(),
     template_version: template.version
   })
```

**Performance Target**: < 5s  
**References**: T0-HEFESTO-01, T0-HEFESTO-07, FR-008

---

### Phase 3: Validation

```markdown
1. Validate against Agent Skills spec
   (see: helpers/template-validator.md)
   
   validation_errors = validate_skill(skill_content)
   
   CHECK:
     - Valid frontmatter (name, description)
     - Name: lowercase, hyphens, max 64 chars
     - Description: not empty, max 1024 chars
     - SKILL.md < 500 lines
     - No secrets or credentials (T0-HEFESTO-11)

2. Block persistence if validation fails
   IF validation_errors NOT empty:
     DISPLAY: "‚ùå Validation Failed:"
     FOR EACH error IN validation_errors:
       DISPLAY: "  - {error.code}: {error.message}"
       DISPLAY: "    Fix: {error.remediation}"
     
     ERROR E-CREATE-005: "Template validation failed"
     ABORT (do not proceed to Human Gate)
```

**Performance Target**: < 500ms  
**References**: T0-HEFESTO-06, FR-004

---

### Phase 4: Human Gate

```markdown
1. Display preview
   (see: helpers/human-gate.md)
   
   DISPLAY:
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚úÖ Skill Generated: {skill_name}
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   
   Preview:
   -----------------------------------------
   name: {skill_name}
   description: {description}
   version: 1.0.0
   created: {timestamp}
   target_clis: {targets}
   -----------------------------------------
   
   [First 20 lines of SKILL.md content...]
   
   -----------------------------------------
   
   Validation: PASS ‚úÖ
   
   Files to create:
     {FOR EACH cli}
     - .{cli}/skills/{skill_name}/SKILL.md
     - .{cli}/skills/{skill_name}/metadata.yaml
   
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

2. Prompt for approval
   PROMPT: "Actions: [approve] [expand] [edit] [reject]"
   
   INPUT: action
   
   CASE action:
     "approve" ‚Üí PROCEED to Phase 5
     "expand"  ‚Üí DISPLAY full skill content, re-prompt
     "edit"    ‚Üí Allow manual edits (advanced), re-validate
     "reject"  ‚Üí ABORT, "Operation cancelled. No changes made."
     timeout   ‚Üí ABORT after 120 seconds

3. Block persistence on rejection
   IF action != "approve":
     DISPLAY: "Operation cancelled. No changes made."
     CLEANUP: Discard all in-memory state
     ABORT
```

**Timeout**: 120 seconds for Human Gate response  
**References**: T0-HEFESTO-02, FR-002, human-gate.md

---

### Phase 5: Persistence

```markdown
1. Create directories
   FOR EACH target_cli IN targets:
     skill_dir = ".{target_cli}/skills/{skill_name}/"
     TRY:
       create_directory(skill_dir)
     CATCH PermissionError:
       ERROR E-CREATE-006: "Write permission denied: {skill_dir}"
       ABORT (rollback all prior creations)

2. Write skill files
   FOR EACH target_cli IN targets:
     skill_path = ".{target_cli}/skills/{skill_name}/SKILL.md"
     metadata_path = ".{target_cli}/skills/{skill_name}/metadata.yaml"
     
     write_file(skill_path, skill_content)
     write_file(metadata_path, metadata)

3. Update MEMORY.md
   state = read_memory_md()
   state.skills_created.append({
     name: skill_name,
     created: current_timestamp(),
     clis: targets,
     status: "active"
   })
   write_memory_md(state)

4. Success message
   DISPLAY:
   ‚úÖ Skill created successfully!
   
   Name: {skill_name}
   Location(s):
     {FOR EACH cli IN targets}
     - .{cli}/skills/{skill_name}/SKILL.md
   
   Next steps:
   - Validate: /hefesto.validate {skill_name}
   - View: /hefesto.show {skill_name}
   - Test: Use the skill with your AI CLI
```

**Performance Target**: < 1s  
**References**: T0-HEFESTO-05, FR-002

---

### Phase 6: Collision Handling

```markdown
collision_gate():
  DISPLAY:
  ‚ö†Ô∏è  Skill already exists: {skill_name}
  
  Existing location(s):
    {FOR EACH existing_path}
    - {existing_path}
  
  Created: {existing_metadata.created}
  Last modified: {file_mtime}
  
  Actions:
  [overwrite] - Replace existing skill (creates backup)
  [rename]    - Choose different name
  [cancel]    - Abort operation
  
  INPUT: action
  
  CASE action:
    "overwrite":
      create_backup(existing_path)
      DISPLAY: "Backup created: .hefesto/backups/{skill_name}-{timestamp}.tar.gz"
      RETURN continue_with_overwrite
    
    "rename":
      PROMPT: "New skill name:"
      INPUT: new_name
      skill_name = sanitize_name(new_name)
      RETRY collision check with new name
    
    "cancel":
      ABORT "Operation cancelled"
```

**References**: FR-008, T0-HEFESTO-08

---

## Error Cases

| Code | Condition | Handler |
|------|-----------|---------|
| **E-CREATE-001** | Description exceeds 2000 chars | Error + suggest shortening |
| **E-CREATE-002** | Invalid skill name generated | Auto-sanitize per T0-HEFESTO-07 |
| **E-CREATE-003** | Skill already exists | Trigger collision Human Gate (FR-008) |
| **E-CREATE-004** | No CLIs detected | Error + suggest `/hefesto.detect` |
| **E-CREATE-005** | Template validation fails | Show errors + block persist |
| **E-CREATE-006** | Write permission denied | Error with path details |
| **E-CREATE-007** | Empty description | Error + re-prompt in wizard |
| **E-CREATE-008** | Template not found | Error + list available templates |

**Error Format**:
```
ERROR [E-CREATE-XXX]: {Description}
Suggestion: {Remediation action}
Usage: /hefesto.create [description] [--target <cli>]
```

**References**: spec.md L80-86

---

## Usage Examples

### Example 1: Basic Creation

```bash
> /hefesto.create "Validate email addresses using regex patterns"

Generating skill from description...
Detected CLIs: claude, gemini
Suggested name: validate-email

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚úÖ Skill Generated: validate-email
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

[Preview shown...]

Actions: [approve] [expand] [edit] [reject]
> approve

‚úÖ Skill created successfully!

Name: validate-email
Location(s):
  - .claude/skills/validate-email/SKILL.md
  - .gemini/skills/validate-email/SKILL.md
```

### Example 2: Wizard Mode

```bash
> /hefesto.create

üßô Wizard Mode: Create Skill
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

What should this skill do? (1-2 sentences)
> Run Jest tests with coverage reporting

Suggested name: run-jest-tests
Press Enter to accept, or type custom name:
> [Enter]

Detected CLIs: claude, opencode
Target CLIs (comma-separated or 'all') [all]:
> claude

Preview:
  Name: run-jest-tests
  Description: Run Jest tests with coverage reporting
  Target CLIs: claude

[continue] [edit] [cancel]
> continue

[Proceeds to generation and Human Gate...]
```

### Example 3: Specific Target

```bash
> /hefesto.create "Deploy application to AWS Lambda" --target gemini

Generating skill from description...
Target CLI: gemini (manually specified)

[Proceeds with single-CLI generation...]
```

### Example 4: Collision Handling

```bash
> /hefesto.create "Validate email with improved regex"

Generating skill from description...
Suggested name: validate-email

‚ö†Ô∏è  Skill already exists: validate-email

Existing location(s):
  - .claude/skills/validate-email/SKILL.md

Created: 2026-02-04 10:00:00

Actions:
[overwrite] - Replace existing skill (creates backup)
[rename]    - Choose different name
[cancel]    - Abort operation

> rename

New skill name:
> validate-email-v2

[Proceeds with new name...]
```

---

## Success Criteria

- ‚úÖ **SC-001**: Command implemented and executable
- ‚úÖ **SC-003**: Human Gate triggered 100% before persist
- ‚úÖ **SC-004**: Wizard mode activates when description missing
- ‚úÖ **SC-005**: Documentation embedded in help

---

## Performance Targets

| Operation | Target | Typical |
|-----------|--------|---------|
| Context loading | < 500ms | 200ms |
| Argument parsing | < 100ms | 50ms |
| Skill generation | < 5s | 2s |
| Validation | < 500ms | 200ms |
| Human Gate wait | unbounded | N/A |
| Persistence | < 1s | 500ms |
| **Total (excl. Human Gate)** | **< 7s** | **~3s** |

---

## Dependencies

**Required Helpers:**
- `helpers/human-gate.md` - Approval workflow
- `helpers/template-validator.md` - T0 compliance check
- `helpers/cli-detector.md` - Available CLIs

**Required Templates:**
- `templates/base/SKILL.md.template`
- `templates/base/metadata.yaml.template`

**State Files:**
- `MEMORY.md` - Skill registry and CLI detection

---

## See Also

- **Related Commands**: `/hefesto.extract`, `/hefesto.validate`, `/hefesto.show`
- **Specification**: `specs/003-hefesto-commands/contracts/create.contract.md`
- **T0 Rules**: `CONSTITUTION.md` (T0-HEFESTO-01, 02, 06, 07, 08)
- **User Story**: `specs/003-hefesto-commands/spec.md` US1
